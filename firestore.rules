rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Reglas para la colección de menús
    match /menus/{menuId} {
      allow read: if true; // Todos pueden leer los menús
      allow write: if request.auth != null && request.auth.token.admin == true; // Solo administradores pueden escribir
    }
    
    // Reglas para la colección de coordinadores
    match /coordinators/{coordinatorId} {
      allow read: if true; // Todos pueden leer la lista de coordinadores
      allow write: if request.auth != null && request.auth.token.admin == true; // Solo administradores pueden escribir
    }
    
    // Reglas para la colección de confirmaciones de asistencia
    match /attendanceConfirmations/{confirmationId} {
      allow read: if true; // Todos pueden leer las confirmaciones
      allow create: if request.auth != null; // Usuarios autenticados pueden crear
      allow update, delete: if request.auth != null && 
                            (request.auth.token.admin == true || 
                             resource.data.coordinatorId == request.auth.uid); // Solo el coordinador que creó o un admin puede modificar
    }
    
    // Reglas para la colección de platillos
    match /dishes/{dishId} {
      allow read: if true; // Todos pueden leer los platillos
      allow write: if request.auth != null && request.auth.token.admin == true; // Solo administradores pueden escribir
    }
    
    // Reglas para la colección de órdenes
    match /orders/{orderId} {
      allow read: if request.auth != null; // Solo usuarios autenticados pueden leer
      allow create: if request.auth != null; // Usuarios autenticados pueden crear
      allow update, delete: if request.auth != null && 
                            (request.auth.token.admin == true || 
                             resource.data.userId == request.auth.uid); // Solo el usuario que creó o un admin puede modificar
    }
  }
}
